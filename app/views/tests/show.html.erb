<%= link_to "Back to #{current_user.organization.name}", organization_path %>

<% if current_user.role == 'admin' %>
  <%= link_to "Delete test", project_test_path, method: :delete %>
<% end %>

<div class="container">
  <h2>Test name : <%= @test.name %></h2>
  <h3>Test type : <%= @test.ga_report_type.capitalize %> </h3>
  <h3>REGEX used : <%= @test.event_category_regex %> </h3>
  <% if @last_result == nil %>
    <p>No result yet 😢 <br>Come back later</p>
  <% else %>
    <table>
      <tr>
        <h4>Last run details</h4>
      </tr>
      <tr>
        <td>Run date</td>
        <td><%= @last_result.created_at %></td>
      </tr>
      <tr>
        <td>Total transactions</td>
        <td><%= @last_result.number_total_values %></td>
      </tr>
        <td>Total incorrect transactions </td>
        <td><%= @last_result.number_incorrect_values %></td>
      </tr>
      </tr>
        <td>delta / previous test run</td>
        <td> <%= percentage_between_results(@last_result, @before_last_result) %> % soit ecart de <%= diff_between_results(@last_result, @before_last_result) %> transactions
        </td>
      </tr>
        </tr>
        <td>Top 3 incorrect values</td>
        <td></td>
      </tr>
      </tr>
        <td>“Moogle Tee White”</td>
        <td>3 transactions</td>
      </tr>
      </tr>
        <td>“GGGGDSSSS”</td>
        <td>2 transactions</td>
      </tr>
      </tr>
        <td>“Google Large Tote Canvas”</td>
        <td>2 transactions</td>
      </tr>
      </tr>
        <td></td>
        <td>Last 5 runs</td>
      </tr>
    </table>
  <% @test.results.last(5).each do |result| %>
    <p>--- <%= result.created_at %>---</p>
    <p>correct values <%= result.number_total_values %> values</p>
    <p>incorrect values <%= result.number_incorrect_values %> values</p>
  <% end %>
<% end %>
</div>
